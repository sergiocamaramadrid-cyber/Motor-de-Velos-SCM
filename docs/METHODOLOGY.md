# SCM Framework — Methodology

**Version:** v0.6.0  
**Author:** Sergio Cámara Madrid  
**Frozen baseline date:** 2026-02-26

---

## Overview

This document describes the statistical methodology implemented in the SCM Framework
(Motor de Velos — Fluid Condensation Model) for evaluating galaxy rotation curves.
All procedures are deterministic, pre-specified, and fully reproducible from source.

---

## 1. Out-of-Sample Validation (GroupKFold)

Galaxy-level leave-group-out cross-validation is performed using `GroupKFold` to
prevent data leakage across radial points belonging to the same galaxy.

- **Folds:** 5 (configurable)
- **Grouping:** galaxy identifier
- **Metric:** OOS residual distribution (median ≈ 0 is the null hypothesis)

Implementation: `src/scm_analysis.py`

---

## 2. Structural Permutation Test

A permutation null test verifies that the SCM hinge term captures genuine structural
variance rather than noise.

- The hinge activation is permuted within galaxies.
- The observed test statistic is compared against the permuted distribution.
- A p-value < 0.05 is required to claim structural significance.

---

## 3. Variance Inflation Factor (VIF) Diagnostics

Multicollinearity among regression predictors is assessed via VIF.

- **Threshold:** VIF < 10 for all predictors (standard threshold)
- **Output:** `audit/vif_table.csv`

---

## 4. Numerical Stability — Condition Number

The design matrix condition number (κ) measures numerical stability of the regression.

- **Threshold:** κ < 30 (well-conditioned)
- **Output:** `audit/stability_metrics.csv`

---

## 5. Hinge Definition

The SCM hinge term activates in the deep-regime (high surface density):

```
hinge(x) = max(0, x - threshold)
```

This structural form reflects the physical transition predicted by the Fluid
Condensation model.

---

## 6. Audit Pipeline

The full audit is generated by:

```bash
python scripts/audit_scm.py --data-dir data/sparc --outdir results/audit_v0.6
```

Outputs written to `<outdir>/audit/`:

| File | Description |
|------|-------------|
| `vif_table.csv` | VIF for each predictor |
| `stability_metrics.csv` | Condition number and related metrics |
| `residual_vs_hinge.csv` | Per-point OOS residuals vs hinge values |
| `residual_vs_hinge.png` | Two-panel diagnostic figure |
| `quality_status.txt` | PASS / WARNING verdict |
| `audit_features.csv` | Feature summary statistics |

---

## 7. Reproducibility Guarantee

All structural parameters are fixed prior to any data analysis.
No post-hoc tuning is performed.
Results are validated by automated tests in `tests/test_audit_scm.py`
and `tests/test_pipeline.py`.

---

## References

- Cámara Madrid, S. (2026). *Motor de Velos — SCM Framework v0.6.0*.
  See `docs/HISTORICAL_NOTE_MOTOR_DE_VELOS.md` for conceptual background.
